<html>
<head>
    <title>Sign In - Quizzy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
    <script>
        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('password');
            const eyeIcon = document.getElementById('eye-icon');
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                eyeIcon.classList.remove('fa-eye');
                eyeIcon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                eyeIcon.classList.remove('fa-eye-slash');
                eyeIcon.classList.add('fa-eye');
            }
        }

        function hideLockIcon() {
            const lockIcon = document.getElementById('lock-icon');
            lockIcon.style.display = 'none'; // Hide the lock icon
        }

        async function handleSignIn(event) {
            event.preventDefault(); // Prevent the default form submission

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const messageDiv = document.getElementById('message');

            // Clear previous messages
            messageDiv.textContent = '';
            messageDiv.className = '';
           
                await fetch(`https://nextgen-quiz-app.vercel.app/auth/signin`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password }), // Assuming username is the email
                })
                .then((res) => {
                if (!res.ok) {
                    throw new Error('Login failed. Please check your email and password.');
                }
                return res.json();
            })
            .then((data) => {
                const token = data.token;
                localStorage.setItem('token', token);
                window.location.href = 'dashboard.html';
            })
            .catch((err) => {
                messageDiv.textContent = err.message;
                messageDiv.className = 'error' // Display error message
            });

        }
    </script>
</head>
<body class="bg-purple-100 flex items-center justify-center min-h-screen">
    <div class="absolute top-10 left-10 flex items-center">
        <div class="bg-purple-500 p-2 rounded">
            <i class="fas fa-question text-white"></i>
        </div>
        <span class="ml-2 text-purple-700 font-bold text-xl">QUIZZY</span>
    </div>
    <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
        <h2 class="text-2xl font-bold text-center">Sign In</h2>
        <p class="text-center text-gray-500 mb-6">Welcome back!</p>
        <button class="w-full flex items-center justify-center border border-gray-300 rounded-lg py-2 mb-4" onclick="window.location.href='coming-soon-signin.html'">
            <img alt="Google logo with a colorful G" class="mr-2" height="20" src="https://storage.googleapis.com/a1aa/image/i_foqQaFop5J-mcfDZ5rAGxAJUzz4wGsu2-XmdbPhxM.jpg" width="20"/>
            Continue with Google
        </button>
        <div class="text-center text-gray-500 mb-4">Or sign in with email</div>
        <form onsubmit="handleSignIn(event)">
            <div class="mb-4">
                <label class="block text-gray-700">Email</label>
                <input id="email" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="Email" type="email" required/>
            </div>
            <div class="mb-4">
                <label class="block text-gray-700">Password</label>
                <div class="relative">
                    <input id="password" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" type="password" required oninput="hideLockIcon()"/>
                    <i id="lock-icon" class="fas fa-lock absolute left-3 top-3 text-gray-400"></i>
                    <i class="fas fa-eye absolute right-3 top-3 text-gray-400 cursor-pointer" id="eye-icon" onclick="togglePasswordVisibility()"></i>
                </div>
            </div>
            <div class="text-right mb-4">
                <a class="text-purple-500" href="forgotpassword.html">Forgot Password</a>
            </div>
            <button type="submit" class="w-full bg-purple-500 text-white py-2 rounded-lg hover:bg-purple-600">Sign In</button>
        </form>
        <div id="message" class="text-center mt-4"></div>
        <div class="text-center mt-4">
            <span class="text-gray-500">Donâ€™t have an account?</span>
            <a class="text-purple-500" href="signup.html">Sign Up</a>
        </div>
    </div>
</body>
</html>